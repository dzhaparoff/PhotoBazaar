!function(){"use strict";function phbContent($location,$cacheFactory,$compile,$timeout,PageLoader){return{restrict:"A",controller:["$element",function($element){"undefined"==typeof $cacheFactory[$location.absUrl()]&&($cacheFactory[$location.absUrl()]=$element.html())}],link:function($scope,$element){function setPageCachedContent(d,n){var template=$(d),compiled=$compile(template);content.html(template),$scope.$applyAsync(function(){compiled($scope),compiled=null,window.scrollTo(0,$cacheFactory["scrollPositions_"+n])})}function setPageFullContent(d){var data=document.createElement("div"),template=$(d),compiled=$compile(template);$(data).html(d);var imgLoad=imagesLoaded($(data)),items_count=$(data).find("img").length,cur_item=0;content.html(template),$timeout(function(){compiled($scope),compiled=null}),imgLoad.on("progress",function(){var progress=cur_item/items_count*100;cur_item+=1,$scope.$emit("loading_progress",progress)}),imgLoad.on("always",function(){imgLoad.off("progress"),imgLoad.off("always"),$("body").find(".loader.page_loader").fadeOut(333,function(){$(this).remove(),$scope.$emit("loading_complete")}),imgLoad=null,template=null,data=null})}var setPageFullContent,setPageCachedContent,content=($location.url(),$element),disableLocationListener=!1,loader='<div class="ui large loader page_loader"></div>';$scope.$on("disableLocationListener",function(e,v){disableLocationListener=v}),$scope.$on("$locationChangeSuccess",function(e,n,o){n===o||_.isEmpty(n)||disableLocationListener||($cacheFactory["scrollPositions_"+o]=window.scrollY,content.empty(),"undefined"==typeof $cacheFactory[n]?($("body").append(loader).find(".loader.page_loader").fadeIn(333),PageLoader.getPageFullContent(n).then(function(d){200==d.status&&($cacheFactory[n]=d.data,setPageFullContent(d.data))})):setPageCachedContent($cacheFactory[n],n))})}}}angular.module("phb").directive("phbContent",phbContent),phbContent.$inject=["$location","$cacheFactory","$compile","$timeout","PageLoader"]}();