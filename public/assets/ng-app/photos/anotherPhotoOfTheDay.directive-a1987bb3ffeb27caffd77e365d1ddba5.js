!function(){"use strict";function anotherPhotoOfTheDay(){return{restrict:"A",scope:{number:"@",photoUrl:"@",hoverColor:"@"},link:function($scope,$element){function setScroll(){scrolling=!0}function animate_on_scroll(){var requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;if(scrolling){var scroll_parralax_position=window.scrollY+(height-.8*height)/2-position;this_e.css({transform:"translate3d(0px,"+scroll_parralax_position/4+"px,0px)"}),background_element.css({transform:"translate3d(0px,"+scroll_parralax_position/3+"px,0px)"})}requestID=requestAnimationFrame(animate_on_scroll)}function set_new_layer_on_page(){for(number=parseInt($scope.number)+1,height=$(window).height();0==$('[data-bp-number="'+number+'"]').length;)++number;$('[data-bp-number="'+number+'"]').each(function(index){pos_array[index]=$(this).offset().top+$(this).height()/2});var last_elements=_.takeRight(_.sortBy(pos_array),3);position=last_elements.reduce(function(a,b){return a+b})/3;var scroll_parralax_position=window.scrollY+(height-.8*height)/2-position;this_e.css({top:position,height:.8*height,transform:"translate3d(0px,"+scroll_parralax_position/4+"px,0px)"}),background_element.css({transform:"translate3d(0px,"+scroll_parralax_position/3+"px,0px)"})}var position,number,height,scrolling,requestID,pos_array=[],this_e=$element;$element.append("<div class='background' style='background-image:url("+$scope.photoUrl+")'></div>"),$element.append("<div class='cloak_bg' style='background-color: rgba("+$scope.hoverColor+")'></div>");var background_element=$element.find(".background");set_new_layer_on_page(),$element.velocity({opacity:1},{duration:350,delay:500}),document.addEventListener("scroll",setScroll,!1),document.addEventListener("mousewheel",setScroll,!1),animate_on_scroll(),$element.bind("$destroy",function(){document.removeEventListener("scroll",setScroll,!1),document.removeEventListener("mousewheel",setScroll,!1),window.cancelAnimationFrame(requestID),requestID=void 0})}}}angular.module("phb").directive("anotherPhotoOfTheDay",anotherPhotoOfTheDay)}();