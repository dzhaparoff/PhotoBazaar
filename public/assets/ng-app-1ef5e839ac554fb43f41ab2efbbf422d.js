var phb=angular.module("phb",["ngCollection","ngResource"]);phb.config(["$resourceProvider",function($resourceProvider){$resourceProvider.defaults.stripTrailingSlashes=!1}]),phb.config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0)}]),phb.factory("helpers",function(){return{colorBrightness:function(color){rgb=color.split(",");var o=Math.round((299*parseInt(rgb[0])+587*parseInt(rgb[1])+114*parseInt(rgb[2]))/1e3);return o>125?!0:!1}}}),phb.filter("date_from_now",function(){return function(input){var day=new moment.utc(input,"YYYY-MM-DD hh:mm:ss UTC");return day.fromNow()}}),phb.directive("photosPaginator",function($rootScope){return{restrict:"A",replace:!0,template:'<div class="ui vertical menu"><a class="active item">{{pagenumber}}</a></div>',link:function($scope){$scope.pagenumber=$rootScope.page_number,$scope.$on("next_page_pending",function(){$.fancybox.showLoading()}),$scope.$on("next_page_loading_complete",function(){$.fancybox.hideLoading()})}}}),phb.directive("infinitePaginationPhotosList",function($location,$http,$compile){var old_page_number=0;return page_number=1,{restrict:"A",scope:{total:"@",perPage:"@",id:"@"},link:function($scope,$element){var $li=$element.children("li");scrollListner=function(){var scrollDelta=document.body.scrollHeight-$(window).scrollTop()-document.body.clientHeight;300>scrollDelta&&show_page("next"),0==$(window).scrollTop()&&show_page("prev")},changePageOnScroll=function(){var winTop=$(window).scrollTop(),top=$.grep($li,function(item){return $(item).position().top<=winTop});if(top.length>0){var element=_.last(top),page=$(element).attr("data-page");$scope.page_number=page,old_page_number!=page&&$scope.$applyAsync(),old_page_number=page}},show_page=function(mode){var path=new Url($location.absUrl()),pages=[];$($li).each(function(){pages.push($(this).attr("data-page"))});var first_page_number=_.min(pages),last_page_number=_.max(pages),pages_count=parseInt($scope.total/$scope.perPage)+1,navigate_Photos=!1;path.query.mode="partial","next"==mode&&pages_count>last_page_number?(page_number=parseInt(last_page_number)+1,navigate_Photos="append"):"prev"==mode&&first_page_number>1&&(page_number=parseInt(first_page_number)-1,navigate_Photos="prepend"),path.query.page=page_number,navigate_Photos&&($scope.$emit("next_page_pending",page_number),$http.get(path.toString()).success(function(data){var template=$(data);$compile(template)($scope);var imgLoad=imagesLoaded(template);imgLoad.on("progress",function(instance,image){image.isLoaded?"loaded":"broken";imgLoad.off("progress")}),imgLoad.on("always",function(){"append"==navigate_Photos&&$element.append(template),"prepend"==navigate_Photos&&$element.prepend(template),$li=$element.children("li"),init_AnimOnScroll($scope.id,0),$(document).on("scroll",function(){scrollListner(),changePageOnScroll()}),imgLoad.off("always"),$scope.$emit("next_page_loading_complete",page_number)})}),$(document).off("scroll"))},$(document).on("scroll",function(){scrollListner()}),init_AnimOnScroll=function(element,viewportFactor){new AnimOnScroll(document.getElementById(element),{minDuration:.4,maxDuration:.7,viewportFactor:viewportFactor})},init_AnimOnScroll($scope.id,.2),$scope.$watch("page_number",function(n,o){n!=o&&n>0&&$location.search("page",n)});var imgLoad=imagesLoaded($element);imgLoad.on("progress",function(instance,image){image.isLoaded?"loaded":"broken";imgLoad.off("progress")})}}}),phb.directive("photoItemInList",function(helpers){return function($scope,$element,$attr){$scope.$applyAsync(function(){$($element).find(".author").popup({popup:$($element).find(".popup"),on:"hover"})});var hash=$attr.baseColor,rgb=parseInt(hash.substring(1,3),16)+","+parseInt(hash.substring(3,5),16)+","+parseInt(hash.substring(5,7),16);helpers.colorBrightness(rgb)&&$($element).find(".dimmer").addClass("blackcolor"),$($element).find(".image_overflow").css({background:hash}),$($element).find(".dimmer").css({background:"radial-gradient(rgba("+rgb+",0.7), rgba("+rgb+",0.9))"}),$($element).children("a").dimmer({on:"hover"}),$($element).find(".image").velocity("stop").velocity({scale:1.05},0),$($element).children("a").hover(function(){$(this).find(".top").velocity("stop").velocity({paddingTop:15},300,[.44,.2,.33,.63]),$(this).find(".bottom").velocity("stop").velocity({paddingBottom:15},300,[.44,.2,.33,.63]),$(this).find(".image").velocity("stop").velocity({scale:1},320,[.49,.15,.27,.83])},function(){$(this).find(".top").velocity("stop").velocity({paddingTop:0},300,[.44,.2,.33,.63]),$(this).find(".bottom").velocity("stop").velocity({paddingBottom:0},300,[.44,.2,.33,.63]),$(this).find(".image").velocity("stop").velocity({scale:1.05},320,[.49,.15,.27,.83])})}}),phb.directive("createdAt",function($timeout,$filter){return function(scope,element,attrs){function updateTime(){element.text(filter(time))}function updateLater(){timeoutId=$timeout(function(){updateTime(),updateLater()},intervalLength)}var time=attrs.createdAt,intervalLength=3e4,filter=$filter("date_from_now");element.bind("$destroy",function(){$timeout.cancel(timeoutId)}),updateTime(),updateLater()}}),phb.controller("Photos",function(){}),phb.run(["$rootScope",function(){}]);